@page
@model Snackis_Forum_.Pages.PostsModel
@using Microsoft.AspNetCore.Identity
@using Snackis_Forum_.Areas.Identity.Data

@inject SignInManager<ForumUser> SignInManager
@inject UserManager<ForumUser> UserManager
@{
}

<div>
    <div>
        <h1 class="display-4">Tråd med posts</h1>

        @if (Model.ThreadList != null)
        {
            <div class="text-center">
                @foreach (var thread in Model.ThreadList.Where(t => t.Id == Model.ThreadId))
                {
                    <h1>@thread.TreadTitle</h1>
                }
            </div>

            @if (Model.PostList != null)
            {
                @foreach (var post in Model.PostList.Where(p => p.ThreadId == Model.ThreadId).OrderBy(p => p.PostDate))
                {
                    <div class="text-left border border-dark" style="margin-bottom:30px; width:700px;">
                        <div style="background-color: lightgreen; height:30px">

                            <p>
                                &ensp;Skapad av
                                @if (post.Author == "")
                                {
                                    <span>Gäst</span>
                                }
                                else
                                {
                                    <span>@UserManager.FindByIdAsync(post.Author).Result.NickName</span>
                                }
                                Postat den: @post.PostDate
                                Svar på: @post.AnswerToId

                            </p>
                        </div>
                        <div class="text-center row" style="margin-left:10px; margin-top:10px; margin-bottom:10px;">
                            <div class="border" style="margin-right:10px">
                                @if (post.Author == "")
                                {
                                    <img src="~/img/user_profile_picture.png">
                                }
                                else if (@UserManager.FindByIdAsync(post.Author).Result.ProfilePicture != null)
                                {
                                    <img src="~/img/@UserManager.FindByIdAsync(post.Author).Result.ProfilePicture" />
                                }
                                else
                                {
                                    <img src="~/img/user_profile_picture.png">
                                }
                            </div>
                            <p style="margin-top:30px">@post.Text</p>

                        </div>
                        <div>
                            <a class="btn btn-success btn-sm" onclick="ShowForm(@post.Id)">Skapa nytt inägg</a>

                            <form method="post" style="float:right">
                                <input type="hidden" name="reported" value="@post.Id" />
                                <input type="submit" class="btn btn-danger btn-sm" value="Anmäl inlägg" style="font-weight:normal" />
                            </form>

                            <div style="display:none" id="@post.Id">
                                <form method="post">
                                    <textarea rows="4" cols="70" name="posttext"></textarea>
                                    <input type="hidden" name="answerTo" value="@post.Id" />
                                    <input type="submit" value="Skicka" onclick="HideForm()" />
                                </form>
                            </div>
                        </div>

                    </div>

                }
            }

        }
    </div>
</div>