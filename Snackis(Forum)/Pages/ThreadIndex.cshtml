@page
@model ThreadIndexModel
@using Microsoft.AspNetCore.Identity
@using Snackis_Forum_.Areas.Identity.Data

@inject SignInManager<ForumUser> SignInManager
@inject UserManager<ForumUser> UserManager
@{
    ViewData["Title"] = "Trådindex";
}


<div>
    <div>
            @if (SignInManager.IsSignedIn(User))
            {
                <a class="btn btn-success float-right mb-2" asp-page="NewThread" asp-route-SubjectId="@Model.SubjectId">Skapa ny tråd</a>
            }
            

        @if (Model.ThreadList != null)
        {
            
            <table class="table table-success m-0 text-center">
                <thead>
                    <tr class="bg-success text-center ">
                        <th>
                            @foreach (var subject in Model.SubjectList.Where(t => t.Id == Model.SubjectId))
                            {
                                <h1 class="text-dark">@subject.Name</h1>
                            }
                        </th>
                    </tr>
                </thead>
            </table>


    <table class="table table-success">
        <thead>
            <tr class="table-success">
                <td class="font-weight-bold">
                    Rubrik
                </td>
                <td class="font-weight-bold">
                    Startad av
                </td>
                <td class="font-weight-bold">
                    Skapad
                </td>
                <td class="font-weight-bold">
                    Senaste inlägg
                </td>
            </tr>
        </thead>
        @foreach (var thread in Model.ThreadList.Where(s => s.SubjectId == Model.SubjectId).OrderByDescending(s => s.LatestPost))
        {
            <tr class="table-success p-2">
                <td>
                    <a class="text-dark" asp-page="/Posts" asp-route-ThreadId="@thread.Id">
                        @thread.TreadTitle
                    </a>
                </td>
                <td>
                    @if (@thread.AuthorId == "")
                    {
                        <p>Gäst</p>
                    }
                    else
                    {
                        if ((UserManager.FindByIdAsync(@thread.AuthorId).Result) == null)
                        {
                            <p>Borttagen</p>
                        }
                        else
                        {
                            @UserManager.FindByIdAsync(@thread.AuthorId).Result.NickName
                        }
                    }
                </td>
                <td>
                    @thread.CreationDate.ToShortDateString() @thread.CreationDate.ToShortTimeString()
                </td>
                <td>
                    @thread.LatestPost.ToShortDateString() @thread.LatestPost.ToShortTimeString()
                </td>
            </tr>
        }
    </table>
            <br />
            <br />
        }
    </div>
</div>